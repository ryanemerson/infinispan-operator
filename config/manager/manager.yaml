apiVersion: v1
kind: Namespace
metadata:
  labels:
    control-plane: controller-manager
  name: system
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: controller-manager
  namespace: system
  labels:
    control-plane: controller-manager
spec:
  selector:
    matchLabels:
      control-plane: controller-manager
  replicas: 1
  template:
    metadata:
      annotations:
        kubectl.kubernetes.io/default-container: manager
      labels:
        control-plane: controller-manager
    spec:
      serviceAccountName: controller-manager
      containers:
        - name: manager
          image: operator:latest
          args:
            - operator
            - --leader-elect
          imagePullPolicy: Always
          livenessProbe:
            httpGet:
              path: /healthz
              port: 8081
            initialDelaySeconds: 15
            periodSeconds: 20
          readinessProbe:
            httpGet:
              path: /readyz
              port: 8081
            initialDelaySeconds: 5
            periodSeconds: 10
          env:
            - name: WATCH_NAMESPACE
              valueFrom:
                fieldRef:
                  fieldPath: metadata.namespace
            - name: INFINISPAN_OPERAND_VERSIONS
              value: |-
                [
                  {
                    "upstream-version": "15.1.7",
                    "image": "quay.io/infinispan/server:15.1.7.Final"
                  },
                  {
                    "upstream-version": "15.2.0",
                    "image": "quay.io/infinispan-test/server:main"
                  }
                ]
            - name: POD_NAME
              valueFrom:
                fieldRef:
                  fieldPath: metadata.name
